syntax = "proto3";

package chat.v1;

import "google/protobuf/timestamp.proto";
import "google/protobuf/empty.proto";

service ChatService {
    rpc Join(JoinRequest) returns (JoinResponse) {}
    rpc Leave(LeaveRequest) returns (LeaveResponse) {}
    rpc Send(SendRequest) returns (google.protobuf.Empty) {}
    rpc Fetch(google.protobuf.Empty) returns (stream FetchResponse) {}
    rpc Subscribe(google.protobuf.Empty) returns (stream SubscribeResponse) {}
    rpc HealthCheck(google.protobuf.Empty) returns (HealthCheckResponse) {}
}

message JoinRequest {
    string user_name = 1;
    optional string user_id = 2;
}

message JoinResponse {
    string user_id = 1;
}

message LeaveRequest {
    string user_id = 1;
}

message LeaveResponse {
}

message Reaction {
    string user_id = 1;
    string message_id = 2;
    string reaction = 3;
}

message Message {
    string message_id = 1;
    string user_id = 2;
    string content = 3;
    repeated Reaction reactions = 4;
    google.protobuf.Timestamp created_time = 5;
}

message SendRequest {
    string user_id = 1;
    string content = 2;
}

message FetchResponse {
    repeated Message messages = 1;
}

enum SubscribeResponseType {
    MESSAGE = 0;
    REACTION = 1;
}

message SubscribeResponse {
    SubscribeResponseType type = 1;
    string user_id = 2;
}

message HealthCheckResponse {
    string status = 1;
}
